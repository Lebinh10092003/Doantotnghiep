{% load static %}
{% load group_tags %}

<div class="row g-3 align-items-stretch">
  {# Thanh ngày trong tuần (calendar ngang) #}
  <div class="col-12 col-lg-8">
    <div class="bg-light rounded-4 p-3 h-100 d-flex flex-column">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div class="small text-muted">
          Tuần {{ start|date:"W" }} • {{ start|date:"d/m" }} - {{ end|date:"d/m/Y" }}
        </div>
      </div>

      <div class="d-flex gap-2 justify-content-between flex-nowrap">
        {% for day in week_days %}
          <a href="?day={{ day|date:'Y-m-d' }}"
             class="text-decoration-none flex-fill">
            <div class="text-center py-2 rounded-4
                        {% if day == selected_date %}text-white{% else %}text-dark{% endif %}">
              <div class="small fw-semibold text-uppercase mb-1
                          {% if day == selected_date %}text-white{% else %}text-muted{% endif %}">
                {% with wd=day|date:"w" %}
                  {% if wd == "1" %}
                    T2
                  {% elif wd == "2" %}
                    T3
                  {% elif wd == "3" %}
                    T4
                  {% elif wd == "4" %}
                    T5
                  {% elif wd == "5" %}
                    T6
                  {% elif wd == "6" %}
                    T7
                  {% else %}
                    CN
                  {% endif %}
                {% endwith %}
              </div>
              <div class="fs-5 fw-bold">
                {{ day|date:"d" }}
              </div>
              <div class="mt-1" style="min-height: 0.75rem;">
                {% if day in session_dates %}
                  <span class="badge rounded-pill
                               {% if day == selected_date %}
                                 bg-white text-success
                               {% else %}
                                 bg-success-subtle text-success
                               {% endif %}">
                    •
                  </span>
                {% endif %}
              </div>
            </div>
          </a>
        {% endfor %}
      </div>
    </div>
  </div>

  {# Panel bên phải: buổi học trong ngày được chọn #}
  <div class="col-12 col-lg-4">
    <div class="bg-white rounded-4 border h-100 p-3 d-flex align-items-center justify-content-center">
      {% if selected_sessions %}
        <div class="w-100">
          {% for s in selected_sessions %}
            <div class="mb-3 pb-3 border-bottom {% if forloop.last %}border-0 mb-0 pb-0{% endif %}">
              <div class="small text-muted mb-1">
                <i class="bi bi-calendar-event me-1"></i>
                {{ s.date|date:"d/m/Y" }} •
                {{ s.start_time|time:"H:i"|default:"--:--" }}
                {% if s.end_time %}
                  - {{ s.end_time|time:"H:i" }}
                {% endif %}
              </div>
              <div class="fw-semibold mb-1">
                {{ s.klass.name }}
              </div>
              <div class="small text-muted mb-1">
                {{ s.klass.subject.name }}
              </div>
              <div class="small text-muted mb-2">
                <i class="bi bi-person-badge me-1"></i>
                {{ s.klass.main_teacher.get_full_name|default:"Chưa phân công" }}
              </div>
              <button type="button"
                      class="btn btn-sm btn-outline-success"
                      hx-get="{% url 'class_sessions:session_detail' s.pk %}"
                      hx-target="#sessions-modal-content"
                      hx-swap="innerHTML"
                      data-bs-toggle="modal"
                      data-bs-target="#sessions-modal"
                      @click="modalTitle = 'Chi tiết Buổi: {{ s.klass.name|escapejs }} - Buổi {{ s.index }}'">
                Xem chi tiết
              </button>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="text-center">
          <div class="spinner-border text-success mb-3" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <p class="text-muted small mb-0">
            Không có buổi học nào vào ngày
            {{ selected_date|date:"d/m/Y" }}.
          </p>
        </div>
      {% endif %}
    </div>
  </div>
</div>
