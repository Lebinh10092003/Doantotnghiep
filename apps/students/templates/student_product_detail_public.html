{% load static %}
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ product.title }} | Sản phẩm học sinh</title>
  <link rel="shortcut icon" href="{% static 'compiled/svg/favicon.svg' %}" type="image/svg+xml">
  <link rel="stylesheet" href="{% static 'compiled/css/app.css' %}">
  <link rel="stylesheet" href="{% static 'compiled/css/iconly.css' %}">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        crossorigin="anonymous">
</head>
<body class="bg-light" style="background:#f3f7ff;">
  <nav class="navbar navbar-expand-lg bg-white border-bottom shadow-sm">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center gap-2" href="{% url 'common:home' %}">
        <img src="{% static 'compiled/svg/logo.svg' %}" alt="Logo" style="height: 36px;">
        <strong>EDS Center</strong>
      </a>
      <div class="d-flex gap-2">
        <a href="{% url 'common:home' %}" class="btn btn-outline-secondary btn-sm">Trang chủ</a>
        {% if request.user.is_authenticated %}
          <a href="{% url 'common:dashboard' %}" class="btn btn-primary btn-sm">Vào dashboard</a>
        {% else %}
          <a href="{% url 'accounts:login' %}?next={{ request.path }}" class="btn btn-primary btn-sm">Đăng nhập</a>
        {% endif %}
      </div>
    </div>
  </nav>

  <main class="py-5">
    <div class="container">
      <div class="row g-4">
        <div class="col-12 col-lg-8">
          <div class="card border-0 shadow-sm rounded-4 mb-4">
            <div class="card-body p-4">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <a href="javascript:window.history.back()" class="btn btn-outline-secondary btn-sm rounded-pill">
                  ← Quay lại
                </a>
              </div>
              <div class="d-flex justify-content-between align-items-center mb-3">
                <div class="d-flex align-items-center gap-3">
                  <div class="rounded-circle bg-light overflow-hidden d-flex align-items-center justify-content-center" style="width:54px;height:54px;">
                    {% if product.student.avatar %}
                      <img src="{{ product.student.avatar.url }}" alt="{{ product.student.get_full_name|default:product.student.username }}" class="w-100 h-100" style="object-fit: cover;">
                    {% else %}
                      <img src="{% static 'assets/images/logo/logoprodcut.png' %}" alt="Avatar mặc định" class="w-100 h-100" style="object-fit: cover;">
                    {% endif %}
                  </div>
                  <div>
                    <div class="text-muted small">Nhà sáng tạo</div>
                    <div class="fw-semibold">{{ product.student.get_full_name|default:product.student.username }}</div>
                  </div>
                </div>
                {% if product.embed_code %}
                  <a href="#embed" class="btn btn-success btn-sm px-4 rounded-pill">Xem embed</a>
                {% elif product.video %}
                  <a href="#video" class="btn btn-success btn-sm px-4 rounded-pill">Xem video</a>
                {% endif %}
              </div>

              <div class="ratio ratio-16x9 rounded-4 overflow-hidden bg-light">
                {% if product.image %}
                  <img src="{{ product.image.url }}" alt="{{ product.title }}" class="w-100 h-100" style="object-fit: cover;">
                {% else %}
                  <img src="{% static 'assets/images/logo/logoprodcut.png' %}" alt="Sản phẩm" class="w-100 h-100" style="object-fit: cover;">
                {% endif %}
              </div>

              <div class="mt-4">
                <h3 class="mb-2">{{ product.title }}</h3>
                <p class="text-muted">{{ product.description|linebreaksbr|default:"Không có mô tả" }}</p>
              </div>

              {% if product.video %}
              <div id="video" class="mt-4">
                <div class="fw-semibold mb-2 d-flex align-items-center gap-2">
                  <i class="bi bi-camera-video text-primary"></i> Video
                </div>
                <div class="ratio ratio-16x9 rounded-4 overflow-hidden bg-dark">
                  <video controls class="w-100 h-100" poster="{{ product.image.url|default:'' }}">
                    <source src="{{ product.video.url }}">
                    Trình duyệt không hỗ trợ video.
                  </video>
                </div>
              </div>
              {% endif %}

              {% if product.embed_code %}
              <div id="embed" class="mt-4">
                <div class="fw-semibold mb-2 d-flex align-items-center gap-2">
                  <i class="bi bi-code-slash text-success"></i> Mã nhúng
                </div>
                <div class="ratio ratio-16x9 rounded-4 overflow-hidden bg-white border">
                  {{ product.embed_code|safe }}
                </div>
              </div>
              {% endif %}
            </div>
          </div>
        </div>

        <div class="col-12 col-lg-4">
          <div class="card border-0 shadow-sm rounded-4 mb-3">
            <div class="card-body">
              <h6 class="mb-3">Thông tin tác giả</h6>
              <div class="d-flex align-items-center gap-3">
                <div class="rounded-circle bg-light overflow-hidden d-flex align-items-center justify-content-center" style="width:48px;height:48px;">
                  {% if product.student.avatar %}
                    <img src="{{ product.student.avatar.url }}" alt="{{ product.student.get_full_name|default:product.student.username }}" class="w-100 h-100" style="object-fit: cover;">
                  {% else %}
                    <img src="{% static 'assets/images/logo/logoprodcut.png' %}" alt="Avatar mặc định" class="w-100 h-100" style="object-fit: cover;">
                  {% endif %}
                </div>
                <div>
                  <div class="fw-semibold">{{ product.student.get_full_name|default:product.student.username }}</div>
                  <div class="text-muted small">Học sinh lớp {{ product.session.klass.name }}</div>
                </div>
              </div>
            </div>
          </div>

          <div class="card border-0 shadow-sm rounded-4 mb-3">
            <div class="card-body">
              <h6 class="mb-3">Khóa học liên quan</h6>
              <div class="d-flex gap-3">
                <div class="rounded-circle overflow-hidden" style="width:64px;height:64px;">
                  {% if product.session.klass.subject.avatar_url %}
                    <img src="{{ product.session.klass.subject.avatar_url }}" class="w-100 h-100" style="object-fit: cover;" alt="subject">
                  {% else %}
                    <img src="{% static 'assets/images/logo/logoprodcut.png' %}" class="w-100 h-100" style="object-fit: cover;" alt="subject">
                  {% endif %}
                </div>
                <div>
                  <div class="fw-semibold">{{ product.session.klass.subject.name|default:"Môn học" }}</div>
                  <div class="text-muted small">Lớp: {{ product.session.klass.name }}</div>
                  <div class="text-muted small">Buổi {{ product.session.index }} - {{ product.session.date|date:"d/m/Y" }}</div>
                </div>
              </div>
            </div>
          </div>

          <div class="card border-0 shadow-sm rounded-4">
            <div class="card-body">
              <h6 class="mb-3">Sản phẩm liên quan</h6>
              {% if related_products %}
                <div class="d-flex flex-column gap-3">
                  {% for rp in related_products %}
                  <a class="d-flex gap-3 text-decoration-none text-dark" href="{% url 'students:student_product_detail_public' pk=rp.pk %}">
                    <div class="rounded overflow-hidden" style="width:72px;height:72px;">
                      {% if rp.image %}
                        <img src="{{ rp.image.url }}" class="w-100 h-100" style="object-fit: cover;" alt="{{ rp.title }}">
                      {% else %}
                        <img src="{% static 'assets/images/logo/logoprodcut.png' %}" class="w-100 h-100" style="object-fit: cover;" alt="Sản phẩm">
                      {% endif %}
                    </div>
                    <div class="flex-grow-1">
                      <div class="fw-semibold small mb-1">{{ rp.title }}</div>
                      <div class="text-muted small">Bởi {{ rp.student.get_full_name|default:rp.student.username }}</div>
                      <div class="text-muted small">{{ rp.created_at|date:"d/m/Y" }}</div>
                    </div>
                  </a>
                  {% endfor %}
                </div>
              {% else %}
                <p class="text-muted small mb-0">Chưa có sản phẩm liên quan.</p>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer class="py-4 bg-dark text-white-50">
    <div class="container d-flex flex-wrap justify-content-between gap-3">
      <div>
        <div class="d-flex align-items-center gap-2 mb-2">
          <img src="{% static 'compiled/svg/logo.svg' %}" alt="Logo" style="height:28px">
          <strong class="text-white">EDS Center</strong>
        </div>
        <small>© 2025 EDS Center. All rights reserved.</small>
      </div>
      <div class="d-flex flex-column">
        <a href="{% url 'common:home' %}#gioi-thieu" class="link-light">Giới thiệu</a>
        <a href="{% url 'common:home' %}#khoa-hoc" class="link-light">Khóa học</a>
        <a href="{% url 'common:home' %}#lien-he" class="link-light">Liên hệ</a>
      </div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
</body>
</html>
