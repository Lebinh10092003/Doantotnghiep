{% load widget_tweaks %}

<tr 
  id="student-row-{{ data.student.id }}"
  class="student-row {% if success %}flash-success{% endif %}"
>
  <td class="fw-bold">
    {{ data.student.display_name_with_email }}
  </td>
  
  {# Cột trạng thái điểm danh #}
  <td>
    {% if data.attendance %}
      {% if data.attendance.status == "P" %}
        <span class="badge bg-success">Có mặt</span>
      {% elif data.attendance.status == "A" %}
        <span class="badge bg-danger">Vắng</span>
      {% elif data.attendance.status == "L" %}
        <span class="badge bg-warning text-dark">Muộn</span>
      {% else %}
        <span class="badge bg-secondary">{{ data.attendance.get_status_display }}</span>
      {% endif %}
    {% else %}
      <span class="badge bg-secondary">Chưa điểm danh</span>
    {% endif %}
  </td>
  
  {# Cột Ghi chú điểm danh #}
  <td>
    {% if data.attendance and data.attendance.note %}
      <span class="text-body">{{ data.attendance.note }}</span>
    {% else %}
      <span class="text-muted">-</span>
    {% endif %}
  </td>
  
  {# Cột Điểm #}
  <td>
    {% if data.assessment and data.assessment.score is not None %}
      {{ data.assessment.score }}
    {% else %}
      <span class="text-muted">-</span>
    {% endif %}
  </td>
  
  {# Cột Nhận xét #}
  <td>
    {% if data.assessment and data.assessment.remark %}
      <span class="text-body">{{ data.assessment.remark }}</span>
    {% else %}
      <span class="text-muted">-</span>
    {% endif %}
  </td>
  
  {# Cột Hành động #}
  <td class="text-nowrap">
    <div class="d-flex gap-1">
      {% if can_edit_records %}
        <button type="button" 
              class="btn btn-sm btn-primary"
              hx-get="{% url 'class_sessions:student_attendance_assessment_modal' session.id data.student.id %}?_={{ data.student.id }}-{% now 'U' %}&amp;as_page={{ as_page|yesno:'true,false,false' }}"
              hx-target="#attendance-modal-content"
              hx-on::after-request="if(event.detail.successful) bootstrap.Modal.getOrCreateInstance(document.getElementById('attendance-modal')).show()"
              title="Điểm danh &amp; đánh giá cho học sinh này">
        <i class="bi bi-clipboard-check"></i>
      </button>
      {% endif %}

      {% if perms.accounts.view_user %}
        <button type="button" 
                class="btn btn-sm btn-info"
                hx-get="{% url 'accounts:user_detail' data.student.id %}"
                hx-target="#session-student-detail-modal-content"
                data-bs-toggle="modal" 
                data-bs-target="#session-student-detail-modal"
                title="Xem chi tiết học sinh">
          <i class="bi bi-person"></i>
        </button>
      {% endif %}
    </div>
  </td>
</tr>
