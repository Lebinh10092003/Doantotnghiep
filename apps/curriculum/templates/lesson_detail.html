<div class="modal-body">
  <div class="row">
    <div class="col-md-6">
      <p><strong>Môn học:</strong> {{ lesson.module.subject.name }} ({{ lesson.module.subject.code }})</p>
      <p><strong>Học phần:</strong> {{ lesson.module.title }}</p>
    </div>
    <div class="col-md-6">
      <p><strong>Thứ tự:</strong> {{ lesson.order }}</p>
      <p><strong>Tiêu đề:</strong> {{ lesson.title }}</p>
    </div>
  </div>

  <hr>

  <h6>Mục tiêu bài học</h6>
  {% if lesson.objectives %}
    <div class="p-2 bg-light border rounded">{{ lesson.objectives|linebreaksbr }}</div>
  {% else %}
    <p class="text-muted">Chưa có mục tiêu.</p>
  {% endif %}

  <hr>

  <h6>Bài giảng</h6>
  {% if lesson.lecture %}
    {% if lesson.lecture.content %}
      <div class="p-2 bg-light border rounded mb-2">{{ lesson.lecture.content|linebreaksbr }}</div>
    {% endif %}
    {% if lesson.lecture.file %}
      <p class="mb-1">
        <i class="bi bi-paperclip"></i> <strong>Tệp đính kèm:</strong>
        <a href="{{ lesson.lecture.file.url }}" target="_blank">{{ lesson.lecture.file.name|cut:"lectures/" }}</a>
      </p>
    {% endif %}
    {% if lesson.lecture.video_url %}
      <p class="mb-1"><i class="bi bi-link-45deg"></i> <strong>Liên kết:</strong> <a href="{{ lesson.lecture.video_url }}" target="_blank">{{ lesson.lecture.video_url }}</a></p>
    {% endif %}
  {% else %}
    <p class="text-muted">Chưa có bài giảng.</p>
  {% endif %}

  <hr>

  <h6>Bài tập</h6>
  {% if lesson.exercise %}
    <p class="mb-1"><i class="bi bi-check-circle-fill text-success"></i> <strong>Độ khó:</strong> {{ lesson.exercise.get_difficulty_display }}</p>
    {% if lesson.exercise.description %}
      <div class="p-2 bg-light border rounded mb-2">{{ lesson.exercise.description|linebreaksbr }}</div>
    {% endif %}
    {% if lesson.exercise.file %}
      <p class="mb-1">
        <i class="bi bi-paperclip"></i> <strong>Tệp đính kèm:</strong>
        <a href="{{ lesson.exercise.file.url }}" target="_blank">{{ lesson.exercise.file.name|cut:"exercises/" }}</a>
      </p>
    {% endif %}
    {% if lesson.exercise.link_url %}
      <p class="mb-1"><i class="bi bi-link-45deg"></i> <strong>Liên kết:</strong> <a href="{{ lesson.exercise.link_url }}" target="_blank">{{ lesson.exercise.link_url }}</a></p>
    {% endif %}
  {% else %}
    <p class="text-muted">Chưa có bài tập.</p>
  {% endif %}
</div>

<div id="pane-exercise" hx-swap-oob="innerHTML" style="display:none">
  {% if lesson.exercise %}
    <div class="mb-2">
      <span class="fw-semibold">Mức độ:</span>
      <span class="badge bg-light text-muted">
        {{ lesson.exercise.get_difficulty_display }}
      </span>
    </div>

    {% if lesson.exercise.description %}
      <div class="mb-2 small" style="white-space: pre-line;">
        {{ lesson.exercise.description }}
      </div>
    {% endif %}

    {% if lesson.exercise.file %}
      <p class="small mb-1">
        <i class="bi bi-paperclip me-1"></i>
        <a href="{{ lesson.exercise.file.url }}" target="_blank">
          Tải file bài tập
        </a>
      </p>
    {% endif %}

    {% if lesson.exercise.link_url %}
      <p class="small mb-0">
        <i class="bi bi-link-45deg me-1"></i>
        <a href="{{ lesson.exercise.link_url }}" target="_blank">
          Mở bài tập online
        </a>
      </p>
    {% endif %}

    {% if not lesson.exercise.description and not lesson.exercise.file and not lesson.exercise.link_url %}
      <p class="text-muted small mb-0">
        Bài tập chưa có nội dung chi tiết.
      </p>
    {% endif %}
    <div class="mt-3">
      <a class="btn btn-primary btn-sm" href="{% url 'students:submission_create' lesson.exercise.id %}">Nộp bài tập</a>
    </div>
  {% else %}
    <p class="text-muted small mb-0">
      Chưa có bài tập cho bài học này.
    </p>
  {% endif %}
  {% if exercise_submissions %}
    {% with submission=exercise_submissions.0 %}
      <div class="mt-3">
        <a class="btn btn-outline-primary btn-sm"
           href="{% url 'students:submission_update' submission.id %}?{% if submission.session %}session_id={{ submission.session.id }}&{% endif %}{% if class_id %}class_id={{ class_id }}{% endif %}">
          Chỉnh sửa bài tập
        </a>
      </div>
    {% endwith %}
  {% endif %}
  {% include "_exercise_submissions_list.html" %}
</div>

{% if class_id %}
  {% if class_session %}
    {% include "_session_meta.html" with session=class_session klass=class_session.klass swap_oob=1 empty_message="" %}
  {% else %}
    {% include "_session_meta.html" with session=None klass=None swap_oob=1 empty_message="Không tìm thấy buổi học tương ứng cho bài học này." %}
  {% endif %}
{% endif %}
